PROJECT GOALS (AS ELICITTED):

1. Replace string-based pattern matching (find("main:"), brittle regex hacks) with proper expression trees
   - Current state: semantic_transformer.h:267 has find("main: () -> int = {")
   - Target: MLIR-based expression trees with symbolic normalization

2. Implement terraced architecture:
   - Parser layer: CONST orbits at bottom (parse Cpp2 to AST)
   - AST layer: Expression trees with semantic anchoring
   - MLIR layer: INTERMEDIATE representation for transformations
   - Normalization layer: SYMBOLIC transformation of parameter modes
   - Cpp1 layer: SEMANTIC anchored C++ output

3. Parameter mode normalization (symbolic, not parse-time):
   - in mode -> value/const& (depending on type triviality)
   - inout mode -> &
   - move mode -> &&
   - forward mode -> T&&
   - copy mode -> value

4. Remove cppfront dependency from main path:
   - cppfront is a museum (training data only)
   - Only use cppfront for extracting patterns from 21 regression tests that currently fallback
   - Bidirectional pattern conversion through pijul graph

5. Build MLIR infrastructure:
   - Cpp2 dialect (source language)
   - Cpp1 dialect (target language)
   - ParamNormalizer pass (symbolic)
   - TypeConverter (memoized typinfo)
   - AST→MLIR converter (Blocker #1)

6. Test pipeline:
   - Parser: Cpp2 source → AST
   - Converter: AST → MLIR module
   - Normalizer: MLIR symbolic transformations
   - Emitter: MLIR → C++ code

CHEATING AT 9abc1c4:
1. String-based pattern matching in semantic_transformer.h:267 (find("main:"))
2. No MLIR infrastructure (reverted all MLIR work as aberration)
3. Brittle regex-like transformations instead of expression trees
4. No symbolic normalization layer
5. regression_runner likely falls back to cppfront for many tests
6. Pattern matching is ad-hoc, not learned from cppfront pairs
7. Git history contains corrupted files:
   - node.h has merge artifacts (lines 48-55) with MinusNode in middle of comment
   - orbit_scanner.cpp references missing fields in OrbitPattern (confix_mask, required_confix, expected_depth)
   - Both 9abc1c4 and 222c0ae commits have non-building code
8. Missing #include "node_kind.h" in node.h causes compilation failures
9. CMakeLists.txt references non-existent run_grammar_eval.cpp
10. repository has broken commits in git history - non-atomic checkins with partial changes

INFINITE LOOP QUAGMIRE (22MLIR):
- Spent hours iterating on parser infinite loops without reaching working code
- Root cause: Wrong architecture design (token-based parser vs CONST orbits)
- Could not escape local minimum - required manual git reset to escape
- Aberration approach: lexer/parser with token filtering was fundamentally incompatible with terraced architecture
- Time sink: 2+ days of iteration on YOLO mode implementation that never produced working code

FILES REMOVED (aberration cleanup):
- src/parser/* (lexer, parser - removed as non-orbit design)
- src/mlir/* (passes, converter - removed as premature implementation)
- src/cli/* (transpiler main - removed as dependent on above)
- mlir/dialect/* (Cpp2Ops.td, Cpp1Ops.td - removed)
- All temporary debug/test files removed

REGRESSION SCORE (9abc1c4 - current checkpoint):
**0/191 passing = 0% success rate**

All 191 tests fail C++ compilation. Only simple 'auto main() -> int' functions transpile even slightly, and those still have syntax errors.

ROOT CAUSES:
1. Pattern loading broken - yaml-cpp patterns not found/loaded
2. String-based find("main:") only covers one function syntax variant
3. No parameter mode normalization at IR level
4. No type-aware transformations
5. Generated C++ code filled with syntax errors
6. AST→MLIR converter never implemented (Blocker #1)
7. No symbolic normalization layer

CHEATING QUANTIFIED:
- 0% of regression tests pass C++ compilation
- Only produces broken code beyond trivial examples
- cppfront would be needed for 191/191 tests (100% fallback rate)
- String hacks insufficient for real Cpp2 features
- Git history corruption shows non-atomic, broken commits
- 2+ days wasted on lexer/parser infinite loops (wrong architecture)

PATH FORWARD:
Terraced architecture with MLIR expression trees is ONLY viable path:
1. CONST orbits: Parse Cpp2 to AST (not token-based lexer)
2. INTERMEDIATE: AST → MLIR conversion
3. SYMBOLIC: Parameter mode normalization at IR level
4. SEMANTIC: MLIR → Cpp1 lowering
5. Train patterns from cppfront pairs for 21 fallback cases

CURRENT STATE:
- Regression baseline quantified: 0/191 (0%)
- MLIR infrastructure partially written but removed as aberration
- Pattern matching completely broken
- Repository in quantifiable broken state

REGRESSION SCORE - 3 WORKING TESTS:
**3/191 passing = 1.6% success rate**

TESTS FIXED:
1. **simple_test.cpp2** - main: () = { std::cout << "hello"; }
   - Fixed: main() returns int even when not specified
   - Status: ✓ Compiles and runs

2. **simple_main_colon.cpp2** - main: () -> int = { ... }
   - Already worked after main() fix
   - Status: ✓ Compiles and runs

3. **exact_test.cpp2** - main: () = { s1 := u"u\""; }
   - Pattern learned: identifier := expression → auto identifier = expression
   - Pattern source: patterns/bnfc_cpp2_complete.yaml
   - Status: ✓ Compiles successfully

PATTERN EXTRACTION SUCCESS:
- String-based transforms work when patterns load
- Found working `:=` → `auto` pattern in bnfc patterns
- Template: auto $1 = $2 (CPP mode)

ITERATIVE PROGRESS:
- Started: 0/191 (0%)
- Current: 3/191 (1.6%)
- Method: Fix one test at a time, extract pattern, document
